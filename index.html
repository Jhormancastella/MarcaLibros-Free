<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MarcaLibros Personalizados</title>

  <!-- Favicon desde URL -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://res.cloudinary.com/dipv76dpn/image/upload/v1759597977/undefined_Quiero_una_mezcla_de_d4pb5v.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://res.cloudinary.com/dipv76dpn/image/upload/v1759597977/undefined_Quiero_una_mezcla_de_d4pb5v.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://res.cloudinary.com/dipv76dpn/image/upload/v1759597977/undefined_Quiero_una_mezcla_de_d4pb5v.png">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" />
  
  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --secondary: #7209b7;
      --light: #f8f9fa;
      --dark: #212529;
      --success: #4cc9f0;
      --gray: #6c757d;
      --gray-light: #e9ecef;
      --border-radius: 12px;
      --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
      max-width: 1200px;
      margin: 0 auto;
      color: var(--dark);
      line-height: 1.6;
    }
    
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      text-align: center;
    }
    
    .logo {
      width: 80px;
      height: auto;
      border-radius: 8px;
      box-shadow: var(--box-shadow);
    }
    
    h1 {
      color: var(--primary);
      margin: 0;
      font-size: 2.2rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .subtitle {
      text-align: center;
      color: var(--gray);
      margin-bottom: 30px;
      font-size: 1.1rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .mode-selector {
      text-align: center;
      margin: 30px 0;
    }
    
    .mode-btn {
      margin: 0 10px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background-color: var(--gray-light);
      border: none;
      border-radius: var(--border-radius);
      transition: var(--transition);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .mode-btn:hover {
      background-color: #d5dbdb;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .mode-btn.active {
      background-color: var(--primary);
      color: white;
      box-shadow: 0 4px 12px rgba(67, 97, 238, 0.4);
    }
    
    .upload-section {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 30px;
    }
    
    .upload-container {
      width: 400px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .image-box {
      width: 100%;
      height: 400px;
      border: 2px dashed #bdc3c7;
      background-color: #fff;
      position: relative;
      overflow: hidden;
      border-radius: var(--border-radius);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      box-shadow: var(--box-shadow);
    }
    
    .image-box:hover {
      border-color: var(--primary);
      transform: translateY(-5px);
    }
    
    .image-box.has-image {
      border-style: solid;
      border-color: var(--success);
    }
    
    .image-box img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .upload-placeholder {
      text-align: center;
      color: var(--gray);
      padding: 20px;
    }
    
    .upload-icon {
      font-size: 60px;
      margin-bottom: 15px;
      color: var(--primary);
    }
    
    .upload-text {
      font-size: 16px;
      margin-bottom: 15px;
    }
    
    .upload-btn {
      padding: 10px 20px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
    }
    
    .upload-btn:hover {
      background-color: var(--primary-dark);
    }
    
    .label {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 5px 10px;
      font-size: 14px;
      border-radius: 3px;
      z-index: 10;
    }
    
    button {
      margin: 10px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      transition: var(--transition);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    button:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    button.secondary {
      background-color: var(--secondary);
    }
    
    button.secondary:hover {
      background-color: #6511a0;
    }
    
    #previewContainer {
      margin-top: 40px;
      text-align: center;
      display: none;
      background: white;
      padding: 30px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }
    
    #previewContainer img {
      width: 5cm;
      height: 15cm;
      object-fit: cover;
      border: 1px solid #ddd;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      image-rendering: crisp-edges;
      border-radius: 4px;
    }
    
    #previewContainer.double img {
      width: 10cm;
      height: 15cm;
    }
    
    .controls {
      text-align: center;
      margin-top: 30px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    
    .instructions {
      margin-top: 30px;
      padding: 25px;
      background-color: #fff;
      border-radius: var(--border-radius);
      display: none;
      box-shadow: var(--box-shadow);
      border-left: 5px solid var(--primary);
    }
    
    .instructions h4 {
      margin-top: 0;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .instructions p {
      margin: 10px 0;
      line-height: 1.6;
      color: var(--dark);
    }
    
    footer {
      margin-top: 50px;
      padding: 20px;
      text-align: center;
      background-color: var(--dark);
      color: white;
      border-radius: var(--border-radius);
      font-size: 14px;
    }
    
    .file-input {
      display: none;
    }
    
    .section-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--dark);
      text-align: center;
    }

    .url-input-container {
      margin-top: 20px;
      text-align: center;
    }

    .url-input-container input {
      width: 80%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }

    .url-input-container button {
      padding: 5px 10px;
      font-size: 14px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .url-input-container button:hover {
      background-color: var(--primary-dark);
    }
    
    @media (max-width: 768px) {
      .upload-section {
        flex-direction: column;
        align-items: center;
      }
      
      .upload-container {
        width: 100%;
        max-width: 400px;
      }
      
      .image-box {
        height: 300px;
      }
      
      .controls {
        flex-direction: column;
        align-items: center;
      }
      
      button {
        width: 80%;
        max-width: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://res.cloudinary.com/dipv76dpn/image/upload/v1759597977/undefined_Quiero_una_mezcla_de_d4pb5v.png" alt="Logo MarcaLibros" class="logo">
    <h1>MarcaLibros Personalizados</h1>
  </div>
  <p class="subtitle">Crea tu separador ideal: una cara o doble cara, listo para imprimir</p>

  <div class="mode-selector">
    <button class="mode-btn active" data-mode="single"><i class="bi bi-file-image"></i> Una cara</button>
    <button class="mode-btn" data-mode="double"><i class="bi bi-files"></i> Doble cara</button>
  </div>

  <!-- Modo Una Cara -->
  <div class="upload-section single-mode">
    <div class="upload-container">
      <p class="section-title">Imagen para tu separador</p>
      <div class="image-box" id="box1">
        <div class="upload-placeholder">
          <i class="bi bi-cloud-upload upload-icon"></i>
          <div class="upload-text">Sube tu imagen para el separador</div>
          <button class="upload-btn">Seleccionar imagen</button>
        </div>
        <img id="image1" src="" alt="Imagen 1" />
        <div class="label">Cara 1</div>
      </div>
      <input type="file" id="imageUpload1" accept="image/*" class="file-input" />
      <div class="url-input-container">
        <input type="text" id="imageUrl1" placeholder="Pega la URL de una imagen..." />
        <button onclick="loadImageFromUrl('imageUrl1', 'image1', 'box1')">Cargar desde URL</button>
      </div>
    </div>
  </div>

  <!-- Modo Doble Cara -->
  <div class="upload-section double-mode" style="display:none;">
    <div class="upload-container">
      <p class="section-title">Imagen para la cara frontal</p>
      <div class="image-box" id="box1_double">
        <div class="upload-placeholder">
          <i class="bi bi-cloud-upload upload-icon"></i>
          <div class="upload-text">Sube imagen para la cara frontal</div>
          <button class="upload-btn">Seleccionar imagen</button>
        </div>
        <img id="image1_double" src="" alt="Imagen 1" />
        <div class="label">Cara 1</div>
      </div>
      <input type="file" id="imageUpload1_double" accept="image/*" class="file-input" />
      <div class="url-input-container">
        <input type="text" id="imageUrl1_double" placeholder="Pega la URL de la imagen frontal..." />
        <button onclick="loadImageFromUrl('imageUrl1_double', 'image1_double', 'box1_double')">Cargar desde URL</button>
      </div>
    </div>
    
    <div class="upload-container">
      <p class="section-title">Imagen para la cara trasera</p>
      <div class="image-box" id="box2_double">
        <div class="upload-placeholder">
          <i class="bi bi-cloud-upload upload-icon"></i>
          <div class="upload-text">Sube imagen para la cara trasera</div>
          <button class="upload-btn">Seleccionar imagen</button>
        </div>
        <img id="image2_double" src="" alt="Imagen 2" />
        <div class="label">Cara 2</div>
      </div>
      <input type="file" id="imageUpload2_double" accept="image/*" class="file-input" />
      <div class="url-input-container">
        <input type="text" id="imageUrl2_double" placeholder="Pega la URL de la imagen trasera..." />
        <button onclick="loadImageFromUrl('imageUrl2_double', 'image2_double', 'box2_double')">Cargar desde URL</button>
      </div>
    </div>
  </div>

  <div class="controls">
    <button id="cropButton"><i class="bi bi-scissors"></i> Recortar imagen(es)</button>
    <button id="downloadPdfButton" style="display:none;" class="secondary"><i class="bi bi-file-pdf"></i> PDF (imprimir)</button>
    <button id="downloadPngButton" style="display:none;"><i class="bi bi-image"></i> PNG (alta calidad)</button>
    <button id="downloadJpgButton" style="display:none;"><i class="bi bi-camera"></i> JPG (compartir)</button>
    <button id="uploadToCloudinaryButton" style="display:none;" class="secondary">
      <i class="bi bi-cloud-arrow-up"></i> Subir a Cloudinary
    </button>
  </div>

  <div id="previewContainer">
    <h3>Tu separador final:</h3>
    <img id="finalPreview" src="" alt="Separador" />
  </div>

  <div class="instructions" id="instructions">
    <h4><i class="bi bi-info-circle"></i> Instrucciones de impresi√≥n y armado:</h4>
    <p id="instructionText"></p>
  </div>

  <footer>
    ¬© 2025 Jhorman Jes√∫s Castellanos Morales ‚Äì Todos los derechos reservados.
  </footer>

  <!-- Librer√≠as -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
  <script>
    let cropper1, cropper2;
    let croppedCanvas1, croppedCanvas2;
    let currentMode = 'single';

    // Cambiar modo
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentMode = this.dataset.mode;

        const singleSection = document.querySelector('.single-mode');
        const doubleSection = document.querySelector('.double-mode');
        const previewContainer = document.getElementById('previewContainer');
        const instructions = document.getElementById('instructions');
        const cropButton = document.getElementById('cropButton');
        const downloadPdfButton = document.getElementById('downloadPdfButton');
        const downloadPngButton = document.getElementById('downloadPngButton');
        const downloadJpgButton = document.getElementById('downloadJpgButton');
        const uploadToCloudinaryButton = document.getElementById('uploadToCloudinaryButton');

        if (currentMode === 'single') {
          singleSection.style.display = 'flex';
          doubleSection.style.display = 'none';
        } else {
          singleSection.style.display = 'none';
          doubleSection.style.display = 'flex';
        }

        // Resetear
        previewContainer.style.display = 'none';
        instructions.style.display = 'none';
        cropButton.style.display = 'inline-block';
        downloadPdfButton.style.display = 'none';
        downloadPngButton.style.display = 'none';
        downloadJpgButton.style.display = 'none';
        uploadToCloudinaryButton.style.display = 'none';

        if (cropper1) cropper1.destroy();
        if (cropper2) cropper2.destroy();
        cropper1 = cropper2 = null;
        document.getElementById('image1').src = '';
        document.getElementById('image1_double').src = '';
        document.getElementById('image2_double').src = '';
        
        // Resetear estado visual de las cajas
        document.querySelectorAll('.image-box').forEach(box => {
          box.classList.remove('has-image');
          box.querySelector('img').style.display = 'none';
          box.querySelector('.upload-placeholder').style.display = 'flex';
        });
      });
    });

    // --- Eventos de carga de imagen ---
    function initCropper(imgElement) {
      return new Cropper(imgElement, {
        aspectRatio: 1 / 3,
        viewMode: 1,
        dragMode: 'move',
        cropBoxResizable: true,
        cropBoxMovable: true,
        guides: true,
        center: true,
        highlight: false,
        autoCropArea: 0.8,
        responsive: true,
        zoomOnWheel: true,
        zoomOnTouch: true,
      });
    }

    function setupImageUpload(inputId, imageId, boxId) {
      const input = document.getElementById(inputId);
      const image = document.getElementById(imageId);
      const box = document.getElementById(boxId);
      const placeholder = box.querySelector('.upload-placeholder');
      const uploadBtn = placeholder.querySelector('.upload-btn');
      
      uploadBtn.addEventListener('click', () => input.click());
      placeholder.addEventListener('click', e => {
        if (e.target === placeholder) input.click();
      });
      
      input.addEventListener('change', e => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = event => {
          image.src = event.target.result;
          image.style.display = 'block';
          placeholder.style.display = 'none';
          box.classList.add('has-image');
          
          if (boxId === 'box1' || boxId === 'box1_double') {
            if (cropper1) cropper1.destroy();
            cropper1 = initCropper(image);
          } else if (boxId === 'box2_double') {
            if (cropper2) cropper2.destroy();
            cropper2 = initCropper(image);
          }
        };
        reader.readAsDataURL(file);
      });
    }

    setupImageUpload('imageUpload1', 'image1', 'box1');
    setupImageUpload('imageUpload1_double', 'image1_double', 'box1_double');
    setupImageUpload('imageUpload2_double', 'image2_double', 'box2_double');

    // --- Cargar imagen desde URL ---
    function loadImageFromUrl(inputId, imageId, boxId) {
      const urlInput = document.getElementById(inputId);
      const imageUrl = urlInput.value.trim();
      
      if (!imageUrl) {
        alert("Por favor, pega una URL v√°lida.");
        return;
      }

      if (!/^https?:\/\//i.test(imageUrl)) {
        alert("La URL debe comenzar con http:// o https://");
        return;
      }

      const image = document.getElementById(imageId);
      const box = document.getElementById(boxId);
      const placeholder = box.querySelector('.upload-placeholder');

      placeholder.innerHTML = '<div style="text-align: center; color: var(--gray);"><i class="bi bi-hourglass-split"></i> Cargando...</div>';

      image.onload = function() {
        image.style.display = 'block';
        placeholder.style.display = 'none';
        box.classList.add('has-image');
        
        if (boxId === 'box1' || boxId === 'box1_double') {
          if (cropper1) cropper1.destroy();
          cropper1 = initCropper(image);
        } else if (boxId === 'box2_double') {
          if (cropper2) cropper2.destroy();
          cropper2 = initCropper(image);
        }
      };

      image.onerror = function() {
        alert("‚ùå No se pudo cargar la imagen desde la URL. Verifica que sea accesible y p√∫blica.");
        placeholder.innerHTML = `
          <i class="bi bi-cloud-upload upload-icon"></i>
          <div class="upload-text">Sube tu imagen para el separador</div>
          <button class="upload-btn">Seleccionar imagen</button>
        `;
        image.src = '';
        image.style.display = 'none';
        box.classList.remove('has-image');
      };

      image.src = imageUrl;
    }

    // --- Recortar ---
    document.getElementById('cropButton').addEventListener('click', function() {
      if (currentMode === 'single') {
        if (!cropper1) {
          alert("Por favor, sube y recorta la imagen.");
          return;
        }
        croppedCanvas1 = cropper1.getCroppedCanvas({ width: 500, height: 1500 });
        showResult(croppedCanvas1);
      } else {
        if (!cropper1 || !cropper2) {
          alert("Por favor, sube y recorta ambas im√°genes.");
          return;
        }
        croppedCanvas1 = cropper1.getCroppedCanvas({ width: 500, height: 1500 });
        croppedCanvas2 = cropper2.getCroppedCanvas({ width: 500, height: 1500 });

        const combinedCanvas = document.createElement('canvas');
        combinedCanvas.width = 1000;
        combinedCanvas.height = 1500;
        const ctx = combinedCanvas.getContext('2d');
        ctx.drawImage(croppedCanvas1, 0, 0);
        ctx.drawImage(croppedCanvas2, 500, 0);
        showResult(combinedCanvas);
      }
    });

    function showResult(canvas) {
      const preview = document.getElementById('finalPreview');
      preview.src = canvas.toDataURL();
      document.getElementById('previewContainer').classList.toggle('double', currentMode === 'double');
      document.getElementById('previewContainer').style.display = 'block';
      document.getElementById('downloadPdfButton').style.display = 'inline-block';
      document.getElementById('downloadPngButton').style.display = 'inline-block';
      document.getElementById('downloadJpgButton').style.display = 'inline-block';
      document.getElementById('uploadToCloudinaryButton').style.display = 'inline-block';
      document.getElementById('instructions').style.display = 'block';

      const instructionText = document.getElementById('instructionText');
      if (currentMode === 'single') {
        instructionText.innerHTML = `
          <strong>üìÑ Medidas:</strong> 5 cm de ancho √ó 15 cm de alto.<br>
          <strong>üñ®Ô∏è Impresi√≥n:</strong> Papel opalina brillante o mate (180‚Äì250 g/m¬≤).<br>
          <strong>‚úÇÔ∏è Armado:</strong> Recorta con tijeras. ¬°Listo para usar!
        `;
      } else {
        instructionText.innerHTML = `
          <strong>üìÑ Medidas:</strong> 10 cm de ancho √ó 15 cm de alto (5 cm por cara).<br>
          <strong>üñ®Ô∏è Impresi√≥n:</strong> Papel opalina o fotogr√°fico (200‚Äì250 g/m¬≤).<br>
          <strong>‚úÇÔ∏è Armado:</strong> Recorta, dobla por la mitad y pega con pegamento en barra.
        `;
      }
      window.finalCanvas = canvas;
    }

    // --- Descargas ---
    document.getElementById('downloadPdfButton').addEventListener('click', function() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
      const imgData = window.finalCanvas.toDataURL('image/png');
      const widthMM = currentMode === 'single' ? 50 : 100;
      const heightMM = 150;
      const x = (210 - widthMM) / 2;
      const y = (297 - heightMM) / 2;
      doc.addImage(imgData, 'PNG', x, y, widthMM, heightMM);
      doc.setFontSize(16);
      doc.text(`Separador de ${currentMode === 'single' ? 'una cara' : 'doble cara'}`, x, y - 5);
      doc.setFontSize(10);
      doc.text([
        `‚Ä¢ Medidas: ${widthMM}mm √ó ${heightMM}mm`,
        `‚Ä¢ Papel: Opalina o fotogr√°fico (200‚Äì250 g/m¬≤)`,
        `‚Ä¢ Armado: Recortar y, si es doble cara, doblar y pegar.`
      ], x, y + heightMM + 15, { maxWidth: 180 });
      doc.save(currentMode === 'single' ? 'separador-una-cara.pdf' : 'separador-doble-cara.pdf');
    });

    document.getElementById('downloadPngButton').addEventListener('click', function() {
      const link = document.createElement('a');
      link.download = currentMode === 'single' ? 'separador-una-cara.png' : 'separador-doble-cara.png';
      link.href = window.finalCanvas.toDataURL('image/png');
      link.click();
    });

    document.getElementById('downloadJpgButton').addEventListener('click', function() {
      const link = document.createElement('a');
      link.download = currentMode === 'single' ? 'separador-una-cara.jpg' : 'separador-doble-cara.jpg';
      link.href = window.finalCanvas.toDataURL('image/jpeg', 0.95);
      link.click();
    });

    // --- Subir a Cloudinary ---
    const CLOUD_NAME = 'dipv76dpn';
    const UPLOAD_PRESET = 'separadores-preset';

    function uploadToCloudinary(canvas) {
      const formData = new FormData();
      canvas.toBlob(blob => {
        formData.append('file', blob, 'separador.png');
        formData.append('upload_preset', UPLOAD_PRESET);
        formData.append('folder', 'Separadores');

        fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.secure_url) {
            const url = data.secure_url;
            alert(`‚úÖ ¬°Subido con √©xito!\n\nURL p√∫blica:\n${url}\n\n¬°Puedes copiarla y compartirla!`);
            showUploadSuccess(url);
          } else {
            throw new Error('Respuesta inv√°lida de Cloudinary');
          }
        })
        .catch(error => {
          console.error('Error al subir:', error);
          alert('‚ùå Error al subir a Cloudinary. Revisa la consola.');
        });
      }, 'image/png');
    }

    function showUploadSuccess(url) {
      const instructionText = document.getElementById('instructionText');
      instructionText.innerHTML += `
        <br><hr><br>
        <strong>üîó URL p√∫blica del separador:</strong><br>
        <input type="text" value="${url}" readonly style="width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px;">
        <button onclick="copyToClipboard('${url}')" style="margin-top: 5px; padding: 5px 10px; font-size: 14px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">Copiar URL</button>
      `;
    }

    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          alert('‚úÖ URL copiada al portapapeles');
        }).catch(() => {
          fallbackCopyTextToClipboard(text);
        });
      } else {
        fallbackCopyTextToClipboard(text);
      }
    }

    function fallbackCopyTextToClipboard(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      textArea.style.position = "fixed";
      textArea.style.left = "-999999px";
      textArea.style.top = "-999999px";
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      try {
        const successful = document.execCommand('copy');
        const msg = successful ? 'copiado' : 'no copiado';
        alert(successful ? '‚úÖ URL copiada al portapapeles' : '‚ùå No se pudo copiar');
      } catch (err) {
        alert('‚ùå No se pudo copiar. Por favor, seleccione y copie manualmente.');
      }
      document.body.removeChild(textArea);
    }

    document.getElementById('uploadToCloudinaryButton').addEventListener('click', function() {
      if (window.finalCanvas) {
        uploadToCloudinary(window.finalCanvas);
      } else {
        alert('No hay un separador generado para subir.');
      }
    });
  </script>
</body>
</html>
